# 3. TON 网络

任何区块链项目不仅需要区块格式和区块链验证规则和规范，还需要用于传播新块，发送和收集交易等的网络协议。换句话说，每个区块链项目都必须建立专门的 P2P 网络。这个网络必须是点对点的，因为区块链项目通常需要去中心化，因此不能依赖集中的服务器集群，以及使用传统的客户端 - 服务器架构，例如传统的在线银行应用。 即使轻客户端（例如，轻型加密钱包、智能手机应用程序）必须以类似客户端 - 服务器的方式连接到全节点，但实际上它可以自由连接到任何一个全节点。

虽然可以很容易地满足单链项目（如 Bitcoin 或 Ethereum）的网络需求（只需要构建一个“随机”对等覆盖网络，并通过合适的协议传播所有新块和候选交易），但多链项目，如 TON 区块链的要求更高（例如，必须能够支持只订阅一些分片的更新，而不是所有的分片）。因此，TON 项目的网络部分值得单独讨论。

另一方面，一旦支持 TON 区块链所需的更复杂的网络协议到位，就会发现它们可以很容易地用于不一定与 TON 区块链直接相关的项目，从而在 TON 生态系统中创建新服务提供更多的可能性和灵活性。

## 3.1 抽象数据报网络层

构建 TON 网络协议的基础是 TON 抽象数据报网络层 (Abstract Datagram Network Layer)。 它使所有节点能够由 256 位的“抽象网络地址ID”表示，并仅使用这些 256 位网络地址进行通信以识别发送方和收件人。特别是，用户不再关心 IPv4 或 IPv6 地址，UDP 端口号等，它们已被抽象网络层所隐藏。

### 3.1.1 抽象网络地址

抽象网络地址或抽象地址（或简称地址）是一个 256 位整数，实质上大致等于 256 位 ECC 公钥。节点可以任意生成公钥，从而创建不同的网络标识。 但是，必须知道相应的私钥才能接收（和解密）该地址的消息。

实际上，地址本身并不是公钥; 相反，它是序列化 TL-Object（参见2.2.5）的 256 位哈希值（Hash = SHA256），其可以根据构造函数中（前四个字节）描述的几种类型的公钥和地址进行序列化。在最简单的情况下，这个序列化的 TL-Object 只包含一个 4 字节的魔数和一个 256 位的椭圆曲线加密（ECC）公钥; 在这种情况下，地址将等于这个 36 字节的哈希。但也可以使用 2048 位 RSA 或任何其他公钥加密方案。

当一个节点知道了另一个节点的抽象地址时，它还必须接收其 “preimage”（即序列化的 TL-Object，其哈希等于该抽象地址），否则它将无法加密并将数据发送到该地址。

### 3.1.2 用 UDP 实现的低级网络

从几乎所有 TON 网络组件的角度来看，唯一存在的是一个能够将数据报从一个抽象地址（不可靠地）发送到另一个抽象地址的网络（抽象数据网络层）。原则上，抽象数据网络层（ADNL）可以在不同的现有网络技术上实现。 但是，我们将在 IPv4 / IPv6 网络（例如 Internet 或 Intranet）中通过 UDP 实现它，如果UDP不可用，则使用可选的 TCP。


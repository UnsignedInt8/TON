# 1. 概述

本章概述了 TON 区块链的主要特征和设计原理。后续章节提供了有关每个主题的更多详细信息。

## 1.1 一切都是单元

区块中的所有数据和 TON 区块链的状态表示为单元的集合（参见[3, 2.5]）。因此，本章首先对单元进行一般性讨论。

### 1.1.1 TVM 单元

 回想一下，TON 区块链以及 TON 虚拟机（TVM; 参见[4]）将所有永久存储的数据表示为所谓的单元的集合或"包"(bag of cells)。 每个单元由最多 1023 个数据位和最多四个对其他单元的引用组成。 不允许单元循环引用，因此单元通常被组织成单元树，或者更确切地说是单元的有向无环图（DAG）。任何抽象的代数（依赖）数据类型都可以表示（序列化）为单元树。 将抽象数据类型的值通过 TL-B Schemes 精确的表示为单元树。在 [4, 3.1] 中可以找到对不同类型单元的更全面的讨论。


### 1.1.2 单元应用于 TON 区块和状态

单元特别适用于 TON 区块链的块和状态，它们也是某些（非常复杂的）从属代数数据类型的值。因此，它们根据各种 TL-B Schemes（在本文件中逐渐呈现）进行序列化，并表示为单元的集合或包。

### 1.1.3 单个单元的布局

每个单个单元由最多 1023 个数据位和最多四个对其他单元的引用组成。 当单元保存在内存中时，其精确表示与实现有关。然而，存在单元的标准表示，例如，用于序列化文件存储或网络传输的单元。单元 *c* 的“标准表示”或“标准布局”(CellRepr(c))由以下组成：

1. 首先是两个描述符字节，有时用 *d<sub>1</sub>* 和 *d<sub>2</sub>* 表示。 第一个字节 *d<sub>1</sub>* 等于（在最简单的情况下）单元的引用数量 *0 ≤ r ≤ 4*。 第二个描述符字节 *d<sub>2</sub>* 对单元数据部分的比特长度 *l* 进行编码，如下所示： *d<sub>2</sub>* 的前 7 位等于 ⌊l/8⌋ 即单元中存在的完整数据字节的数量，而 *d<sub>2</sub>* 的最后一位是*完成标记*(*completion tag*)，如果 l 不能被 8 整除，则等于1。 因此，

> (式1) d<sub>2</sub> = 2⌊l/8⌋ + [l mod 8̸ ≠ 0] = ⌊l/8⌋ + ⌈l/8⌉

> 当条件 A 为真时，[A] 等于 1，否则为零。

2. 接下来是 ⌈l/8⌉ 个数据字节。这意味着单元的 l 个数据位被分成 8 个组，每个组被解释为大端 8 位整数并存储到一个字节中。如果 l 不能被 8 整除，则将单个二进制 1 和适当数量的二进制 0（最多 6 个）附加到数据位，并设置完成标记（描述符字节 d<sub>2</sub> 的最低有效位）。

3. 最后是 *r* 个对其他单元的引用。每个引用通常由 32 个字节表示，其中包含引用单元的 SHA256 哈希值，计算方法如 1.1.4 中所述。

以这种方式，具有 *l* 个数据位和 *r* 个引用的单元 *c* 的标准表示 CellRepr(c) 是 *2 + ⌊l/8⌋ + ⌈l/8⌉ + 32r* 字节长。

